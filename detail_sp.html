<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI 도구 상세 정보 및 리뷰를 확인하세요">
    <meta name="keywords" content="AI, AI 도구, AI Curator, 인공지능">
    <meta name="author" content="AI Curator">
    <meta name="robots" content="index, follow">
    <title>AI 도구 상세 - AI Curator</title>
    <link href="assets/css/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="assets/css/common.css">
    <script src="js/bootstrap.js"></script>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <script src="js/theme-manager.js"></script>
    <script src="js/common.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    
    <!-- 다국어 관련 스크립트는 header.html에서 이미 로드됨 -->



    
    <style>
        /* 헤더와 직접 관련 없는 컨텐츠 스타일만 남김1 */
        .tag {
            background-color: #1e3a8a;
            color: #93c5fd;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
            display: inline-block;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            margin-right: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
        }

        .tab-button.active {
            background-color: var(--button-primary);
            color: white;
        }

        .tab-button:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .tab-content {
            display: none;
            padding: 2rem;
            background-color: var(--bg-secondary);
            border-radius: 12px;
            margin-top: 1rem;
        }

        .tab-content.active {
            display: block;
        }

        .pros-cons-item {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
        }

        .pros-cons-item i {
            width: 24px;
            text-align: center;
            margin-right: 0.5rem;
        }

        .pros i {
            color: var(--success-color);
        }

        .cons i {
            color: var(--error-color);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theme-toggle i {
            font-size: 1.25rem;
        }

        .modal-overlay.show { display: flex !important; }

        [data-theme="light"] .btn-primary {
            color: #fff !important;
        }
        [data-theme="light"] .tab-button {
            background: #f3f4f6 !important;
            color: #1a202c !important;
            border: 1px solid #e5e7eb !important;
        }
        [data-theme="light"] .tab-button.active {
            background: #fff !important;
            color: #2563eb !important;
            border-bottom: 2px solid #2563eb !important;
        }
        [data-theme="light"] .tab-content,
        [data-theme="light"] .bg-secondary-bg,
        [data-theme="light"] .pros-cons-item,
        [data-theme="light"] .bg-opacity-10.bg-white,
        [data-theme="light"] .rounded-lg {
            background: #f3f4f6 !important;
            color: #1a202c !important;
        }

        .glass-effect {
            background: rgba(26, 31, 46, 0.85) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(12px) !important;
            -webkit-backdrop-filter: blur(12px) !important;
            box-shadow: 0 2px 8px 0 rgba(0,0,0,0.10) !important;
        }
        .tag.bg-blue-600 { background: #2563eb !important; color: #fff !important; border: none !important; }
        .tag.bg-green-600 { background: #16a34a !important; color: #fff !important; border: none !important; }
        .tag.bg-purple-600 { background: #7c3aed !important; color: #fff !important; border: none !important; }
        .tag.bg-red-600 { background: #dc2626 !important; color: #fff !important; border: none !important; }
        .tag.bg-yellow-600 { background: #ca8a04 !important; color: #fff !important; border: none !important; }
        .tag.bg-pink-600 { background: #db2777 !important; color: #fff !important; border: none !important; }
        .tag.bg-indigo-600 { background: #4f46e5 !important; color: #fff !important; border: none !important; }
        .tag.bg-teal-600 { background: #0d9488 !important; color: #fff !important; border: none !important; }
        [data-theme="light"] .btn-primary {
            background: #2563eb !important;
            color: #fff !important;
        }
        [data-theme="light"] .tag {
            background: #2563eb !important;
            color: #fff !important;
            border: none !important;
        }
        [data-theme="light"] .btn-primary {
            background: #2563eb !important;
            color: #fff !important;
            border-radius: 0.5rem !important;
            font-weight: 500 !important;
            box-shadow: none !important;
            border: none !important;
            padding: 0.75rem 1.5rem !important;
            transition: background 0.2s;
        }
        [data-theme="light"] .btn-primary:hover {
            background: #1d4ed8 !important;
        }

        /* 모달 관련 CSS (index.html과 동일하게 적용) */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: var(--card-bg, #1a1f2e);
            border-radius: 1rem;
            padding: 2rem;
            width: 100%;
            max-width: 28rem;
            position: relative;
            margin: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color, #2d3748);
            border-radius: 0.5rem;
            background-color: var(--card-bg, #1a1f2e);
            color: var(--text-primary, #fff);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        /* 로딩 스피너 스타일 */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: opacity 0.3s ease-in-out;
        }

        .loading-spinner.active {
            display: flex;
        }

        /* 완전히 정적인 로딩 인디케이터 */
        .static-loading-indicator {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-dots {
            display: flex;
            gap: 8px;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            background-color: #3b82f6;
            border-radius: 50%;
            /* 애니메이션 완전 제거 - 정적 상태 */
        }

        .loading-text {
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            margin-top: 0.5rem;
        }

        /* 로딩 인디케이터 페이드 인/아웃 효과 */
        .loading-spinner:not(.active) {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner.active {
            opacity: 1;
        }
        
        /* 부드러운 트랜지션 효과 */
        .loading-spinner {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* 모든 애니메이션 및 transform 강제 비활성화 */
        #loadingSpinner .spinner,
        #loadingSpinner .static-loading-indicator,
        #loadingSpinner .loading-dots,
        #loadingSpinner .dot,
        .loading-spinner .spinner,
        .loading-spinner .static-loading-indicator,
        .loading-spinner .loading-dots,
        .loading-spinner .dot,
        .spinner,
        .loading-spinner,
        .loading-component .loading-spinner {
            animation: none !important;
            transform: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -ms-animation: none !important;
            -o-animation: none !important;
            -webkit-transform: none !important;
            -moz-transform: none !important;
            -ms-transform: none !important;
            -o-transform: none !important;
        }
        
        /* common.css 스피너 스타일 완전 재정의 */
        #loadingSpinner .spinner {
            border: none !important;
            border-radius: 0 !important;
            width: auto !important;
            height: auto !important;
        }

        /* 전역 애니메이션 및 transform 비활성화 */
        * {
            animation: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -ms-animation: none !important;
            -o-animation: none !important;
        }
        
        /* 로딩 스피너만 예외적으로 허용 (정적 상태) */
        .loading-spinner:not(.active) {
            animation: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -ms-animation: none !important;
            -o-animation: none !important;
        }
        
        /* 스크린 리더 전용 클래스 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* 에러 메시지 스타일 */
        .error-message {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ef4444;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .error-message.active {
            display: block;
        }

        /* 다크 테마에서만 탭 컨텐츠 영역 배경 강조 */
        [data-theme="dark"] .tab-content {
            background: #23263a !important;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.10);
            border: 1px solid rgba(59,130,246,0.10);
        }

        /* 지연 로딩 관련 스타일 */
        .lazy {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .lazy.loaded {
            opacity: 1;
        }

        /* 성능 최적화를 위한 애니메이션 - transform 제거 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: none; }
            to { opacity: 1; transform: none; }
        }

        /* 로딩 상태 표시 */
        .loading-placeholder {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* 모바일 최적화 */
        @media (max-width: 768px) {
            .tab-content {
                padding: 1rem;
            }
            
            .glass-effect {
                padding: 1rem !important;
            }
            
            .pros-cons-item {
                padding: 0.75rem;
            }
        }
    </style>
<!-- Firebase SDK: 페이지별 직접 초기화 제거, AuthManager 이벤트만 구독 -->
<script>
  (function() {
    function onReady() {
      // authManagerReady 또는 firebaseInitialized 어느 것이든 수신 시 1회만 처리
      if (window.__authBootstrapDone__) return;
      if (window.auth && window.db) {
        window.__authBootstrapDone__ = true;
      }
    }
    window.addEventListener('authManagerReady', onReady, { once: false });
    window.addEventListener('firebaseInitialized', onReady, { once: false });
  })();
</script>
  
  
  <!-- 공통 모듈: AuthManager 단일 진입점 + DBManager -->
  <script type="module" src="js/auth-manager.js"></script>
  <script type="module" src="js/db-manager.js"></script>
  <script src="js/common.js"></script>
  </head>
  <body>
  <!-- 로딩 인디케이터 -->
  <div id="loadingSpinner" class="loading-spinner active" role="status" aria-label="페이지 로딩 중">
      <div class="static-loading-indicator" aria-hidden="true">
          <div class="loading-dots">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
          </div>
      </div>
      <div class="loading-text">데이터를 불러오는 중...</div>
      <span class="sr-only">페이지 로딩 중...</span>
  </div>

  <!-- 에러 메시지 -->
  <div id="errorMessage" class="error-message" role="alert" aria-live="polite"></div>

  <div id="header-container"></div>
  <script>
    // 로딩 상태 관리 - 전역 변수로 관리
    let isLoading = true;
    let loadingTimeout = null;

    function showLoading() {
        isLoading = true;
        const spinner = document.getElementById('loadingSpinner');
        if (spinner) {
            spinner.classList.add('active');
        }
        
        // 로딩이 너무 오래 걸릴 경우를 대비한 타임아웃 설정
        if (loadingTimeout) {
            clearTimeout(loadingTimeout);
        }
        loadingTimeout = setTimeout(() => {
            console.warn('로딩 타임아웃 발생, 강제로 로딩 숨김');
            hideLoading();
        }, 30000); // 30초 타임아웃
    }

    function hideLoading() {
        isLoading = false;
        const spinner = document.getElementById('loadingSpinner');
        if (spinner) {
            // 부드러운 페이드 아웃 효과
            spinner.style.opacity = '0';
            setTimeout(() => {
                spinner.classList.remove('active');
                spinner.style.opacity = ''; // 스타일 초기화
            }, 300);
        }
        
        if (loadingTimeout) {
            clearTimeout(loadingTimeout);
            loadingTimeout = null;
        }
        
        console.log('로딩 인디케이터 숨김 완료');
    }

    // 에러 메시지 표시
    function showError(message) {
        const errorElement = document.getElementById('errorMessage');
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.classList.add('active');
            
            // 5초 후 자동으로 사라짐
            setTimeout(() => {
                errorElement.classList.remove('active');
            }, 5000);
        }
    }

    // 페이지 로드 시 로딩 표시
    document.addEventListener('DOMContentLoaded', function() {
        showLoading();
        console.log('페이지 로드 시 로딩 시작');
    });

    // DBManager 이벤트 리스너 - 중복 방지
    let dbManagerReadyHandled = false;
    
    window.addEventListener('dbManagerReady', (event) => {
        if (dbManagerReadyHandled) return;
        dbManagerReadyHandled = true;
        
        console.log('DBManager 준비 완료:', event.detail);
        
        if (event.detail && event.detail.success) {
            hideLoading();
        } else {
            showError(event.detail?.error || '데이터베이스 초기화 실패');
            hideLoading();
        }
    }, { once: true });

    window.addEventListener('dbManagerError', (event) => {
        console.error('DBManager 오류:', event.detail);
        showError(event.detail?.error || '오류가 발생했습니다');
        hideLoading();
    }, { once: true });
  </script>
  
  <script type="module">
    // 전역 변수 초기화
    let selectedCategories = new Set();
    let currentSearchQuery = '';
    let allTools = []; // 전역 변수로 allTools 추가
    
    // 기본 이미지 URL 설정
    window.DEFAULT_IMAGE = 'assets/icons/code-icon1.png';
    
    // detail_sp.html 전용 성능 최적화 클래스
    class DetailPageOptimizer {
        constructor() {
            this.toolCache = new Map();
            this.imageCache = new Map();
            this.cacheExpiry = 5 * 60 * 1000; // 5분 캐시 만료
            this.isLoading = false;
            this.loadingQueue = new Map(); // 중복 요청 방지
        }

        // 캐시된 도구 정보 반환
        async getCachedToolDetails(toolId) {
            const cached = this.toolCache.get(toolId);
            if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
                console.log('캐시된 도구 정보 사용:', toolId);
                return cached.data;
            }
            return null;
        }

        // 도구 정보 캐시에 저장
        setCachedToolDetails(toolId, data) {
            this.toolCache.set(toolId, {
                data,
                timestamp: Date.now()
            });
            console.log('도구 정보 캐시에 저장:', toolId);
        }

        // 중복 요청 방지를 위한 로딩 상태 관리
        isToolLoading(toolId) {
            return this.loadingQueue.has(toolId);
        }

        setToolLoading(toolId, loading) {
            if (loading) {
                this.loadingQueue.set(toolId, Date.now());
            } else {
                this.loadingQueue.delete(toolId);
            }
        }

        // 병렬 데이터 로딩 (기존 db-manager.js 수정 없이)
        async loadToolDetailsParallel(toolId) {
            try {
                // 중복 요청 방지
                if (this.isToolLoading(toolId)) {
                    console.log('이미 로딩 중인 도구:', toolId);
                    // 로딩 완료까지 대기
                    while (this.isToolLoading(toolId)) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    // 캐시에서 결과 반환
                    return await this.getCachedToolDetails(toolId);
                }

                this.setToolLoading(toolId, true);

                // 캐시 확인
                const cached = await this.getCachedToolDetails(toolId);
                if (cached) {
                    this.setToolLoading(toolId, false);
                    return cached;
                }

                console.log('병렬 데이터 로딩 시작:', toolId);
                const startTime = performance.now();

                // 기존 db-manager.js의 getToolDetails 사용
                const toolData = await window.dbManager.getToolDetails(toolId);
                
                if (toolData) {
                    // 추가 최적화: 이미지 URL 캐싱
                    if (!this.imageCache.has(toolId)) {
                        this.imageCache.set(toolId, this.getOptimizedImageUrl(toolData));
                    }
                    
                    // 캐시에 저장
                    this.setCachedToolDetails(toolId, toolData);
                    
                    const endTime = performance.now();
                    console.log(`도구 정보 로딩 완료: ${toolId}, 소요시간: ${(endTime - startTime).toFixed(2)}ms`);
                }

                this.setToolLoading(toolId, false);
                return toolData;
            } catch (error) {
                this.setToolLoading(toolId, false);
                console.error('병렬 로딩 실패:', error);
                throw error;
            }
        }

        // 이미지 URL 최적화
        getOptimizedImageUrl(tool) {
            if (tool.logoUrl && tool.logoUrl.startsWith('http')) {
                return tool.logoUrl;
            }
            if (tool.logoFileName) {
                return `https://firebasestorage.googleapis.com/v0/b/ai-tools-data-b2b7b.firebasestorage.app/o/ai_logos%2F${encodeURIComponent(tool.logoFileName)}?alt=media&token=4b780bb4-d39d-4195-8c73-4766eda6ad6b`;
            }
            if (tool.imageUrl && tool.imageUrl.startsWith('http')) {
                return tool.imageUrl;
            }
            return window.DEFAULT_IMAGE || 'assets/icons/code-icon1.png';
        }

        // 캐시 정리 (메모리 관리)
        clearExpiredCache() {
            const now = Date.now();
            let clearedCount = 0;
            
            for (const [key, value] of this.toolCache.entries()) {
                if (now - value.timestamp > this.cacheExpiry) {
                    this.toolCache.delete(key);
                    clearedCount++;
                }
            }
            
            if (clearedCount > 0) {
                console.log(`만료된 캐시 ${clearedCount}개 정리됨`);
            }
        }

        // 캐시 통계
        getCacheStats() {
            return {
                toolCacheSize: this.toolCache.size,
                imageCacheSize: this.imageCache.size,
                loadingQueueSize: this.loadingQueue.size
            };
        }
    }

    // 페이지 로드 시 최적화기 초기화
    let detailOptimizer;
    
    // DBManager 초기화 완료 이벤트 리스너
    window.addEventListener('dbManagerReady', async () => {
      try {
        console.log('DBManager 준비 완료, 최적화기 초기화 시작');
        
        // 최적화기 초기화
        detailOptimizer = new DetailPageOptimizer();
        console.log('DetailPageOptimizer 초기화 완료');
        
        // 초기화 완료 후 필요한 함수들 실행
        allTools = await window.dbManager.loadAITools(20, 4.0);
        console.log('AI 도구 데이터 로드 완료:', allTools.length);
        
        // 주기적 캐시 정리 (5분마다)
        setInterval(() => {
            if (detailOptimizer) {
                detailOptimizer.clearExpiredCache();
            }
        }, 5 * 60 * 1000);
        
        // 초기화 완료 후 로딩 상태 확인 및 정리
        if (isLoading) {
            console.log('DBManager 초기화 완료, 로딩 상태 정리');
            // 즉시 로딩 완료 처리 (지연 시간 단축)
            setTimeout(() => {
                hideLoading();
            }, 300);
        }
        
      } catch (error) {
        console.error('AI 도구 데이터 로드 실패:', error);
        if (window.CommonUtils) {
            window.CommonUtils.handleError(error, 'AI 도구 데이터 로드');
        } else {
            showError('AI 도구 데이터 로드 중 오류가 발생했습니다.');
        }
        
        // 오류 발생 시에도 로딩 상태 정리
        if (isLoading) {
            hideLoading();
        }
      }
    });
    
    // 이미지 로드 실패 시 처리하는 함수
    window.handleImageError = function(img) {
        img.onerror = null; // 무한 루프 방지
        img.src = window.DEFAULT_IMAGE;
    };

    // 이미지 지연 로딩 설정
    function setupImageLazyLoading() {
        const images = document.querySelectorAll('img[data-src]');
        if (images.length === 0) return;

        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.onload = () => {
                        img.classList.remove('lazy');
                        img.classList.add('loaded');
                    };
                    observer.unobserve(img);
                }
            });
        });
        
        images.forEach(img => imageObserver.observe(img));
    }

    // 성능 모니터링
    function setupPerformanceMonitoring() {
        // 페이지 로드 시간 측정
        window.addEventListener('load', () => {
            if (performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                console.log(`페이지 전체 로드 시간: ${loadTime}ms`);
            } else if (performance.getEntriesByType) {
                const navigationEntry = performance.getEntriesByType('navigation')[0];
                if (navigationEntry) {
                    console.log(`페이지 전체 로드 시간: ${navigationEntry.loadEventEnd - navigationEntry.startTime}ms`);
                }
            }
            
            // 성능 지표를 Analytics에 전송 (선택사항)
            if (window.gtag) {
                window.gtag('event', 'timing_complete', {
                    name: 'load',
                    value: Math.round(performance.now())
                });
            }
        });

        // 메모리 사용량 모니터링
        if ('memory' in performance) {
            setInterval(() => {
                const memory = performance.memory;
                console.log('메모리 사용량:', {
                    used: Math.round(memory.usedJSHeapSize / 1024 / 1024) + 'MB',
                    total: Math.round(memory.totalJSHeapSize / 1024 / 1024) + 'MB',
                    limit: Math.round(memory.jsHeapSizeLimit / 1024 / 1024) + 'MB'
                });
            }, 30000); // 30초마다
        }

        // 네트워크 상태 모니터링
        if ('connection' in navigator) {
            const connection = navigator.connection;
            console.log('네트워크 상태:', {
                effectiveType: connection.effectiveType,
                downlink: connection.downlink + 'Mbps',
                rtt: connection.rtt + 'ms'
            });
        }
    }
  
    // 페이지 로드 시 실행
    document.addEventListener('DOMContentLoaded', () => {
        // 초기화 함수 호출
        setupTabs();
        
        // 성능 최적화 설정
        setupImageLazyLoading();
        setupPerformanceMonitoring();
    });
  
    // 전역 객체에 필요한 참조 할당 (Firebase 초기화 후에만)
    window.addEventListener('firebaseInitialized', (event) => {
        const { app, database, auth } = event.detail;
        window.app = app;
        window.db = database;
        window.auth = auth;
    });

        // Firebase 초기화 완료 후 실행될 코드
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('페이지 초기화 시작');
                
                // URL에서 도구 ID 가져오기
                const urlParams = new URLSearchParams(window.location.search);
                const toolId = urlParams.get('id');
                console.log('URL에서 가져온 도구 ID:', toolId);

                if (!toolId) {
                    console.error('도구 ID가 없습니다.');
                    const loginModal = document.getElementById('loginModal');
                    if (loginModal) loginModal.classList.remove('show');
                    hideLoading(); // 로딩 상태 정리
                    return;
                }

                const run = async () => {
                    try {
                        await loadToolDetailsOptimized(toolId);
                        setupTabs();
                        console.log('도구 상세 정보 로드 및 탭 설정 완료');
                    } catch (error) {
                        console.error('도구 상세 정보 로드 실패:', error);
                        showError('도구 정보를 불러오는 중 오류가 발생했습니다.');
                    }
                };

                if (window.dbManager && window.dbManager.isInitialized) {
                    console.log('DBManager 이미 초기화됨, 즉시 실행');
                    await run();
                } else {
                    console.log('DBManager 초기화 대기 중...');
                    window.addEventListener('dbManagerReady', async (e) => {
                        if (e.detail && e.detail.success) {
                            console.log('DBManager 초기화 성공, 도구 정보 로드 시작');
                            await run();
                        } else {
                            console.error('DBManager 초기화 실패:', e.detail && e.detail.error);
                            if (window.CommonUtils) {
                                window.CommonUtils.handleError(new Error(e.detail && e.detail.error || 'DBManager 초기화 실패'), 'DBManager 초기화');
                            } else {
                                showError('데이터베이스 초기화에 실패했습니다.');
                            }
                        }
                    }, { once: true });
                }

                // 저장된 toolId 확인
                const storedToolId = sessionStorage.getItem('pendingToolId');
                if (storedToolId) {
                    const user = auth.currentUser;
                    if (user) {
                        sessionStorage.removeItem('pendingToolId');
                        if (window.location.search !== `?id=${storedToolId}`) {
                            window.location.href = `${window.location.pathname}?id=${storedToolId}`;
                            return;
                        }
                    }
                }
            } catch (error) {
                console.error('페이지 초기화 중 오류 발생:', error);
                if (window.CommonUtils) {
                    window.CommonUtils.handleError(error, '페이지 초기화');
                } else {
                    showError('페이지 로드 중 오류가 발생했습니다.');
                }
                
                // 오류 발생 시 로딩 상태 정리
                hideLoading();
            }
        });

        // 최적화된 도구 상세 정보 로드 함수
        async function loadToolDetailsOptimized(toolId) {
            try {
                // 이미 로딩 중이면 중복 호출 방지
                if (isLoading) {
                    console.log('이미 로딩 중입니다. 중복 호출 방지');
                    return;
                }
                
                showLoading();
                console.log('최적화된 도구 상세 정보 로드 시작:', toolId);
                
                let toolData;
                
                // 최적화기가 준비되었는지 확인
                if (detailOptimizer) {
                    // 최적화된 로딩 사용
                    toolData = await detailOptimizer.loadToolDetailsParallel(toolId);
                } else {
                    // 기존 방식 사용 (폴백)
                    console.log('최적화기 미준비, 기존 방식 사용');
                    toolData = await window.dbManager.getToolDetails(toolId);
                }
                
                if (toolData) {
                    displayToolDetails(toolData, toolId);
                    
                    // 성능 통계 출력
                    if (detailOptimizer) {
                        const stats = detailOptimizer.getCacheStats();
                        console.log('캐시 통계:', stats);
                    }
                    
                    console.log('도구 상세 정보 로드 및 표시 완료');
                } else {
                    if (window.CommonUtils) {
                        window.CommonUtils.showError('해당 AI 도구를 찾을 수 없습니다.');
                    } else {
                        showError('해당 AI 도구를 찾을 수 없습니다.');
                    }
                }
            } catch (error) {
                console.error('도구 상세 정보 로드 중 오류:', error);
                if (window.CommonUtils) {
                    window.CommonUtils.handleError(error, '도구 상세 정보 로드');
                } else {
                    showError('데이터를 불러오는 중 오류가 발생했습니다.');
                }
            } finally {
                // 로딩 완료 즉시 처리
                hideLoading();
            }
        }

        // 기존 loadToolDetails 함수는 최적화된 함수로 대체
        async function loadToolDetails(toolId) {
            return await loadToolDetailsOptimized(toolId);
        }

        // 로그인 상태 감지 및 UI 업데이트
        function setupAuthStateHandler() {
            onAuthStateChanged(auth, (user) => {
                const authButtons = document.getElementById('authButtons');
                const profileMenu = document.getElementById('profileMenu');
                
                if (user) {
                    if (authButtons) authButtons.style.display = 'none';
                    if (profileMenu) profileMenu.style.display = 'flex';
                    
                    const profileElements = [
                        { id: 'profileNameDisplay', value: user.displayName || user.email.split('@')[0] },
                        { id: 'profileEmail', value: user.email },
                        { id: 'profileInitialLarge', value: (user.displayName || user.email)[0].toUpperCase() },
                        { id: 'profileName', value: user.displayName || user.email.split('@')[0] },
                        { id: 'profileInitial', value: (user.displayName || user.email)[0].toUpperCase() }
                    ];
                    
                    profileElements.forEach(element => {
                        const el = document.getElementById(element.id);
                        if (el) el.textContent = element.value;
                    });
                    
                    const displayNameInput = document.getElementById('displayName');
                    if (displayNameInput) displayNameInput.value = user.displayName || '';
                    
                    const emailInput = document.getElementById('email');
                    if (emailInput) emailInput.value = user.email;
                } else {
                    if (authButtons) authButtons.style.display = 'flex';
                    if (profileMenu) profileMenu.style.display = 'none';
                }
            });
        }

        // 별점 표시 생성
        function getStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - Math.ceil(rating);
            
            return `
                ${'<i class="fas fa-star text-yellow-400"></i>'.repeat(fullStars)}
                ${hasHalfStar ? '<i class="fas fa-star-half-alt text-yellow-400"></i>' : ''}
                ${'<i class="far fa-star text-yellow-400"></i>'.repeat(emptyStars)}
            `;
        }

        // 도구 상세 정보 표시 함수
        async function displayToolDetails(toolData, toolId) {
            console.log('toolData:', toolData);
            console.log('toolData.summary:', toolData.summary);
            console.log('toolData.pricing:', toolData.pricing);
            // 2. 항상 최신 id 저장
            window.currentToolId = toolId;
            // 도구 이름과 설명 업데이트
            document.getElementById('tool-name').textContent = toolData.name || '이름 없음';
            document.getElementById('tool-description').textContent = toolData.description || '설명 없음';
            
            // 이미지 업데이트 (지연 로딩 적용)
            const toolImage = document.getElementById('tool-image');
            const optimizedImageUrl = detailOptimizer ? detailOptimizer.getOptimizedImageUrl(toolData) : getValidImageUrl(toolData);
            
            toolImage.innerHTML = `
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E" 
                     data-src="${optimizedImageUrl}" 
                     alt="${toolData.name}" 
                     class="w-full aspect-square bg-gray-700 rounded-lg flex items-center justify-center overflow-hidden lazy" 
                     onerror="window.handleImageError(this)"
                     loading="lazy">
            `;
            
            // 이미지 지연 로딩 재설정
            setupImageLazyLoading();
            
            // 평점 표시
            const ratingSection = document.getElementById('rating-section');
            if (toolData.rating) {
                ratingSection.innerHTML = `
                    <div class="flex items-center mb-4">
                        <div class="rating-stars mr-2">
                            ${getStarRating(toolData.rating)}
                        </div>
                        <span class="text-xl">${toolData.rating.toFixed(1)}</span>
                    </div>
                `;
            } else {
                ratingSection.innerHTML = '<p class="text-gray-400">평점 정보 없음</p>';
            }

            // 태그 표시
            const tagsContainer = document.getElementById('tags-container');
            if (toolData.tags?.length > 0) {
                const tagColors = [
                    'bg-blue-600 text-blue-100',
                    'bg-green-600 text-green-100',
                    'bg-purple-600 text-purple-100',
                    'bg-pink-600 text-pink-100',
                    'bg-yellow-600 text-yellow-100',
                    'bg-red-600 text-red-100',
                    'bg-indigo-600 text-indigo-100',
                    'bg-teal-600 text-teal-100',
                    'bg-orange-600 text-orange-100'
                ];
                tagsContainer.innerHTML = toolData.tags.map((tag, idx) => {
                    const colorClass = tagColors[idx % tagColors.length];
                    return `<span class="tag ${colorClass}">${tag}</span>`;
                }).join('');
            } else {
                tagsContainer.innerHTML = '<span class="text-gray-400">태그 정보 없음</span>';
            }

            // 웹사이트 링크
            const websiteLink = document.getElementById('website-link');
            if (toolData.websiteUrl) {
                websiteLink.href = toolData.websiteUrl;
                websiteLink.style.display = 'inline-flex';
            } else {
                websiteLink.style.display = 'none';
            }

            // 개요 탭 내용 (summary.longDescription 우선, 없으면 description)
            const overviewContent = document.getElementById('overview-content');
            overviewContent.innerHTML = (toolData.summary?.longDescription || toolData.description || '상세 설명이 없습니다.');

            // 장점/단점 (summary.pros, summary.cons)
            const prosContent = document.getElementById('pros-content');
            const consContent = document.getElementById('cons-content');
            prosContent.innerHTML = Array.isArray(toolData.summary?.pros) && toolData.summary.pros.length > 0
                ? toolData.summary.pros.map(pro => `
                    <div class="pros-cons-item pros">
                        <i class="fas fa-check-circle"></i>
                        ${pro}
                    </div>
                `).join('')
                : '<p class="text-gray-400">장점 정보가 없습니다.</p>';

            consContent.innerHTML = Array.isArray(toolData.summary?.cons) && toolData.summary.cons.length > 0
                ? toolData.summary.cons.map(con => `
                    <div class="pros-cons-item cons">
                        <i class="fas fa-times-circle"></i>
                        ${con}
                    </div>
                `).join('')
                : '<p class="text-gray-400">단점 정보가 없습니다.</p>';

            // 주요 기능 탭 내용 (summary.features 또는 features)
            const featuresContent = document.getElementById('features-content');
            const featuresArr = toolData.summary?.features || toolData.features || [];
            featuresContent.innerHTML = featuresArr.length > 0
                ? featuresArr.map(feature => `
                    <div class="bg-opacity-10 bg-white rounded-lg p-4 mb-4">
                        <div class="flex items-start">
                            <i class="fas fa-check text-blue-400 mt-1 mr-3"></i>
                            <div>
                                <h3 class="font-semibold mb-2">${feature}</h3>
                            </div>
                        </div>
                    </div>
                `).join('')
                : '<p class="text-gray-400">기능 정보가 없습니다.</p>';

            // 가격 정책 탭 내용 (pricing 배열)
            const pricingContent = document.getElementById('pricing-content');
            if (Array.isArray(toolData.pricing) && toolData.pricing.length > 0) {
                pricingContent.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        ${toolData.pricing.map(plan => `
                            <div class="bg-opacity-10 bg-white rounded-lg p-6">
                                <h3 class="text-xl font-bold mb-4">${plan.planName || ''}</h3>
                                <p class="text-2xl font-bold mb-4">${plan.price || ''}</p>
                                <p class="text-gray-400">${plan.details || ''}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                pricingContent.innerHTML = '<p class="text-gray-400">가격 정보가 없습니다.</p>';
            }

            // 리뷰 탭 내용 (reviews 배열)
            const reviewsContent = document.getElementById('reviews-content');
            reviewsContent.innerHTML = toolData.reviews?.length > 0
                ? toolData.reviews.map(review => `
                    <div class="bg-opacity-10 bg-white rounded-lg p-6 mb-4">
                        <div class="flex items-center mb-4">
                            <div class="rating-stars mr-2">
                                ${getStarRating(review.rating)}
                            </div>
                            <span class="font-bold">${maskAuthorName(review.author)}</span>
                        </div>
                        <p class="text-text-secondary text-left">${review.comment}</p>
                    </div>
                `).join('')
                : '<p class="text-gray-400">리뷰가 없습니다.</p>';

            // 도구 상세 정보 표시 시 toolId 세팅
            document.getElementById('save-btn-detail').setAttribute('data-toolid', toolId);

            // 저장 버튼 클릭 이벤트
            document.getElementById('save-btn-detail').addEventListener('click', function() {
                // 3. 전역 변수 사용
                handleSave(window.currentToolId);
            });

            // 성능 최적화 완료 로그
            console.log('도구 상세 정보 표시 완료:', toolId);
            if (detailOptimizer) {
                const stats = detailOptimizer.getCacheStats();
                console.log('최적화 통계:', stats);
            }
        }

        // 탭 전환 기능
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    // 모든 탭 버튼에서 active 클래스 제거
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    // 클릭된 탭 버튼에 active 클래스 추가
                    button.classList.add('active');
                    
                    // 모든 탭 컨텐츠 숨기기
                    tabContents.forEach(content => content.classList.remove('active'));
                    // 선택된 탭 컨텐츠 표시
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // 저장하기 기능 (detail)
        async function handleSave(toolId) {
          console.log('저장 시도 toolId:', toolId); // 추가
          // 로그인 상태 확인
          const user = auth.currentUser;
          
          if (!user) {
            alert('로그인이 필요합니다.');
            showLoginModal();
            return;
          }

          try {
            // Firestore에서 도구 정보 가져오기
            const firestore = window.dbManager.db;
            const toolRef = window.dbManager ? window.dbManager.db && window.dbManager.db.constructor.name === 'Firestore' ? window.dbManager : null : null;
            let toolData = null;
            if (window.dbManager && window.dbManager.getToolDetails) {
              toolData = await window.dbManager.getToolDetails(toolId);
            }
            if (!toolData) {
              alert('도구 정보를 찾을 수 없습니다.');
              return;
            }

            // Firestore users/{userId}/favorites/{toolId}에 저장
            const { doc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
            const favRef = doc(firestore, 'users', user.uid, 'favorites', toolId);
            await setDoc(favRef, {
              savedAt: new Date().toISOString(),
              name: toolData.name || '',
              description: toolData.description || '',
              imageUrl: toolData.imageUrl || '',
              rating: toolData.rating || 0,
              priceType: toolData.priceType || '',
              tags: toolData.tags || [],
              websiteUrl: toolData.websiteUrl || '',
              logoFileName: toolData.logoFileName || '',
              logoUrl: toolData.logoUrl || ''
            });
            alert('즐겨찾기에 추가되었습니다.');
            // 버튼 상태 업데이트
            const saveBtn = document.getElementById('save-btn-detail');
            if (saveBtn) {
              saveBtn.innerHTML = '<i class="fas fa-bookmark mr-2"></i> 저장됨';
              saveBtn.classList.add('saved');
            }
          } catch (error) {
            console.error('저장 실패:', error);
            alert('저장 중 오류가 발생했습니다.');
          }
        }

        // 공유하기 모달 detail
        function showShareModal() {
            document.getElementById('shareModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }
        function shareToTwitter() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('AI Curator에서 발견한 멋진 AI 도구를 확인해보세요!');
            window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
        }
        function shareToFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        function copyLink() {
            const toolId = getToolIdFromUrl();
            const url = `${window.location.origin}${window.location.pathname}?id=${toolId}`;
            navigator.clipboard.writeText(url)
                .then(() => alert('링크가 복사되었습니다.'))
                .catch(err => console.error('링크 복사 실패:', err));
        }

        function getToolIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // 1. Fix the handleSuccessfulAuth function to preserve URL parameters
        window.handleSuccessfulAuth = function(user) {
            const originalParams = new URLSearchParams(window.location.search);
            const toolId = originalParams.get('id');
            
            if (toolId) {
                window.location.href = `${window.location.pathname}?id=${toolId}`;
            } else {
                window.location.reload();
            }
        };

        // 리뷰 모달 열기/닫기 및 별점 입력, 저장 기능 추가
        (function() {
            let currentRating = 5;
            document.addEventListener('DOMContentLoaded', function() {
                const writeBtn = document.getElementById('write-review-btn');
                if (writeBtn) {
                    writeBtn.onclick = openReviewModal;
                }
            });
            window.openReviewModal = function() {
                document.getElementById('reviewModal').style.display = 'flex';
                renderStarInput(currentRating);
            };
            window.closeReviewModal = function() {
                document.getElementById('reviewModal').style.display = 'none';
                document.getElementById('review-text').value = '';
            };
            window.renderStarInput = function(rating) {
                currentRating = rating;
                const starDiv = document.getElementById('star-rating-input');
                if (!starDiv) return;
                starDiv.innerHTML = '';
                for (let i = 1; i <= 5; i++) {
                    const star = document.createElement('i');
                    star.className = 'fa-star ' + (i <= rating ? 'fas text-yellow-400' : 'far text-gray-400');
                    star.style.fontSize = '2rem';
                    star.style.cursor = 'pointer';
                    star.onclick = () => window.renderStarInput(i);
                    starDiv.appendChild(star);
                }
            };
            window.submitReview = async function() {
                const comment = document.getElementById('review-text').value.trim();
                if (comment.length < 35) {
                    alert('리뷰는 35자 이상 입력해야 합니다.');
                    return;
                }
                const user = window.auth.currentUser;
                if (!user) {
                    alert('로그인이 필요합니다.');
                    window.closeReviewModal();
                    if (window.showLoginModal) window.showLoginModal();
                    return;
                }
                const toolId = window.currentToolId;
                const db = window.dbManager.db;
                // Firestore SDK 동적 import
                const { doc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                // 리뷰 데이터
                const review = {
                    rating: currentRating,
                    comment,
                    author: user.displayName || user.email.split('@')[0],
                    userId: user.uid,
                    createdAt: new Date().toISOString()
                };
                // 리뷰 ID 생성 (crypto.randomUUID() 사용)
                const reviewId = self.crypto.randomUUID();
                try {
                    // 1. ai-tools/{toolId}/reviews/{reviewId}
                    await setDoc(doc(db, 'ai-tools', toolId, 'reviews', reviewId), review);
                    // 2. users/{userId}/reviews/{reviewId}
                    await setDoc(doc(db, 'users', user.uid, 'reviews', reviewId), {
                        ...review,
                        toolId
                    });
                    window.closeReviewModal();
                    alert('리뷰가 등록되었습니다.');
                    // 리뷰 새로고침
                    if (window.loadToolDetails) await window.loadToolDetails(toolId);
                } catch (error) {
                    alert('리뷰 저장 중 오류가 발생했습니다.');
                    console.error(error);
                }
            };
        })();

        // 이름 마스킹 함수 추가
        function maskAuthorName(name) {
            if (!name) return '';
            // 한글 여부 체크 (첫 글자가 한글이면 한글 이름으로 간주)
            const isKorean = /[가-힣]/.test(name[0]);
            if (isKorean) {
                if (name.length <= 1) return name;
                return name[0] + '*'.repeat(name.length - 1);
            } else {
                if (name.length <= 3) return name;
                return name.slice(0, 3) + '*'.repeat(name.length - 3);
            }
        }

        // getStorageUrl 함수 추가
        function getStorageUrl(fileName) {
            return `https://firebasestorage.googleapis.com/v0/b/ai-tools-data-b2b7b.firebasestorage.app/o/ai_logos%2F${encodeURIComponent(fileName)}?alt=media&token=4b780bb4-d39d-4195-8c73-4766eda6ad6b`;
        }
        // getValidImageUrl 함수 추가
        function getValidImageUrl(tool) {
            if (typeof tool.logoUrl === 'string' && tool.logoUrl.trim() !== '') return tool.logoUrl;
            if (typeof tool.logoFileName === 'string' && tool.logoFileName.trim() !== '') {
                return getStorageUrl(tool.logoFileName);
            }
            if (typeof tool.imageUrl === 'string' && tool.imageUrl.trim() !== '') return tool.imageUrl;
            if (typeof tool.image === 'string' && tool.image.trim() !== '') return tool.image;
            return window.DEFAULT_IMAGE;
        }

</script>

    <main class="container mx-auto px-4 py-8 mt-8 pt-8">
        <div class="max-w-4xl mx-auto">
            <!-- 상단 타이틀 및 라인 -->
            <div class="container" style="margin-top: 32px;">
                <h2 class="text-3xl font-bold text-left mb-2">상세 AI 도구 소개</h2>
                <div style="height:3px; background: #3b82f6; border-radius:2px; margin-bottom: 16px;"></div>
            </div>
            
            <!-- 상단 정보 카드 (반응형) -->
            <div class="glass-effect rounded-xl p-6 md:p-14 flex flex-col md:flex-row items-center md:items-start mb-8 shadow-lg">
              <!-- 도구 이미지 -->
              <div class="w-24 h-24 md:w-32 md:h-32 flex-shrink-0 mb-4 md:mb-0 md:mr-8">
                <div id="tool-image" class="w-full h-full rounded-lg bg-gray-700 flex items-center justify-center overflow-hidden"></div>
              </div>
              <!-- 도구 정보 -->
              <div class="flex-1 flex flex-col items-start w-full">
                <div class="flex flex-col md:flex-row md:items-center w-full">
                  <h1 id="tool-name" class="text-2xl md:text-3xl font-bold mr-0 md:mr-4 mb-2 md:mb-0"></h1>
                  <div id="rating-section" class="flex items-center"></div>
                </div>
                <p id="tool-description" class="text-base md:text-lg text-text-secondary mt-2 mb-4"></p>
                <div id="tags-container" class="flex flex-wrap gap-2 mb-4"></div>
                <div class="flex flex-col sm:flex-row gap-3 w-full">
                  <a id="website-link" href="#" target="_blank" class="flex-1 inline-flex items-center justify-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-medium transition-colors duration-200">
                    <i class="fas fa-external-link-alt mr-2"></i>웹사이트 방문
                  </a>
                  <button id="save-btn-detail" data-toolid="" class="flex-1 inline-flex items-center justify-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-medium transition-colors duration-200" aria-label="AI 도구를 즐겨찾기에 저장">
                    <i class="far fa-bookmark mr-2" aria-hidden="true"></i>저장하기
                  </button>
                  <button id="share-btn-detail" class="flex-1 inline-flex items-center justify-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-medium transition-colors duration-200" aria-label="AI 도구 정보 공유하기">
                    <i class="fas fa-share-alt mr-2" aria-hidden="true"></i>공유하기
                  </button>
                </div>
              </div>
            </div>

            <!-- 탭 메뉴 -->
            <div class="mb-6">
                <style>
                    .tab-button.active {
                        border: 2px solid #2563eb !important;
                        box-shadow: 0 2px 8px 0 rgba(37,99,235,0.10);
                    }
                </style>
                <div class="flex flex-wrap mb-4">
                    <button class="tab-button active" data-tab="overview">개요</button>
                    <button class="tab-button" data-tab="features">주요 기능</button>
                    <button class="tab-button" data-tab="pricing">가격 정책</button>
                    <button class="tab-button" data-tab="reviews" style="display:none;">리뷰</button>
                </div>

                <!-- 개요 탭 -->
                <div id="overview" class="tab-content active bg-secondary-bg rounded-lg">
                    <div id="overview-content" class="mb-8 text-left"></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold mb-4 text-green-400 text-left">장점</h3>
                            <div id="pros-content" class="text-left"></div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4 text-red-400 text-left">단점</h3>
                            <div id="cons-content" class="text-left"></div>
                        </div>
                    </div>
                    <!-- 리뷰 영역 추가 -->
                    <div id="reviews-section" class="mt-10">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-white">AI 사용자 리뷰</h3>
                            <button id="write-review-btn" class="btn-primary">+ 리뷰 작성하기</button>
                        </div>
                        <div id="reviews-content"></div>
                    </div>
                </div>

                <!-- 주요 기능 탭 -->
                <div id="features" class="tab-content bg-secondary-bg rounded-lg">
                    <div id="features-content"></div>
                </div>

                <!-- 가격 정책 탭 -->
                <div id="pricing" class="tab-content bg-secondary-bg rounded-lg">
                    <div id="pricing-content"></div>
                </div>

             
                <!-- 리뷰 탭 (숨김 처리) -->
                <div id="reviews" class="tab-content bg-secondary-bg rounded-lg" style="display:none;">
                    <div id="reviews-content"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- footer.html 포함 -->
    <div id="footer-container"></div>

    <!-- 공유하기 모달 -->
    <div id="shareModal" class="modal-overlay" style="display:none;">
      <div class="modal">
        <div class="modal-close" onclick="closeShareModal()">
          <i class="fas fa-times"></i>
        </div>
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-white">공유하기</h2>
        </div>
        <div class="grid grid-cols-4 gap-4 mb-4">
          <button onclick="shareEmail()" class="flex flex-col items-center">
            <span class="bg-blue-400 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fas fa-envelope text-white text-xl"></i></span>
            <span class="text-xs text-white">메일</span>
          </button>
          <button onclick="shareReddit()" class="flex flex-col items-center">
            <span class="bg-orange-500 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-reddit text-white text-xl"></i></span>
            <span class="text-xs text-white">Reddit</span>
          </button>
          <button onclick="shareWhatsApp()" class="flex flex-col items-center">
            <span class="bg-green-500 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-whatsapp text-white text-xl"></i></span>
            <span class="text-xs text-white">WhatsApp</span>
          </button>
          <button onclick="shareSms()" class="flex flex-col items-center">
            <span class="bg-green-300 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fas fa-sms text-white text-xl"></i></span>
            <span class="text-xs text-white">메시지</span>
          </button>
          <button onclick="shareX()" class="flex flex-col items-center">
            <span class="bg-black rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-x-twitter text-white text-xl"></i></span>
            <span class="text-xs text-white">X</span>
          </button>
          <button onclick="shareFacebook()" class="flex flex-col items-center">
            <span class="bg-blue-700 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-facebook-f text-white text-xl"></i></span>
            <span class="text-xs text-white">Facebook</span>
          </button>
          <button onclick="shareLine()" class="flex flex-col items-center">
            <span class="bg-green-600 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-line text-white text-xl"></i></span>
            <span class="text-xs text-white">Line</span>
          </button>
          <button onclick="shareKakao()" class="flex flex-col items-center">
            <span class="bg-yellow-400 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fas fa-comment text-white text-xl"></i></span>
            <span class="text-xs text-white">카카오톡</span>
          </button>
        </div>
        <button onclick="copyShareLink()" class="w-full flex items-center bg-gray-700 text-white px-4 py-2 rounded mb-2">
          <i class="fas fa-link mr-2"></i> 링크 복사
        </button>
      </div>
    </div>

    <!-- 리뷰 작성 모달 -->
    <div id="reviewModal" class="modal-overlay" style="display:none;">
      <div class="modal">
        <div class="modal-close" onclick="closeReviewModal()">
          <i class="fas fa-times"></i>
        </div>
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-white">리뷰 작성하기</h2>
        </div>
        <div class="flex justify-center mb-4" id="star-rating-input"></div>
        <textarea id="review-text" class="input-field mb-4" rows="4" placeholder="리뷰를 입력하세요 (35자 이상)"></textarea>
        <button onclick="submitReview()" class="btn-primary w-full">리뷰 등록</button>
      </div>
    </div>

</body>
</html>