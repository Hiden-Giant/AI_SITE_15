<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로필 - AI Curator</title>
    <link href="assets/css/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="assets/css/optimized.css">
    <script src="js/theme-manager.js"></script>

    
    <!-- 다국어 관련 스크립트 -->
    <script src="lang/en.js"></script>
    <script src="lang/ko.js"></script>
    <script src="lang/ja.js"></script>
    <script src="lang/zh.js"></script>
    <script src="lang/ru.js"></script>
    <script src="lang/es.js"></script>
    <script src="lang/pt.js"></script>
    <script src="lang/ar.js"></script>
    <script src="lang/vi.js"></script>
    <script src="lang/id.js"></script>
    <script src="lang/fr.js"></script>
    <script src="lang/hi.js"></script>
    <script src="js/translate.js"></script>


    
    <!-- 테마 관련 CSS 변수1 -->
    <style>
        :root {
            /* 다크 모드 기본값 */
            --bg-primary: #121620;
            --bg-secondary: #1a1f2e;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --border-color: #2d3748;
            --card-bg: #1a1f2e;
            --hover-bg: #2d3748;
            --input-bg: #2d3748;
            --modal-bg: #1a1f2e;
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f7fafc;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --card-bg: #ffffff;
            --hover-bg: #edf2f7;
            --input-bg: #f7fafc;
            --modal-bg: #ffffff;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theme-toggle i {
            font-size: 1.25rem;
        }

        .tool-card {
            background: linear-gradient(135deg, #181e2a 80%, #232939 100%);
            border-radius: 1.25rem;
            box-shadow: 0 4px 24px 0 rgba(30,40,80,0.10);
            border: 2px solid #232939;
            padding: 1.5rem 1.5rem 1rem 1.5rem;
            margin-bottom: 1.5rem;
            transition: box-shadow 0.2s, border 0.2s;
            min-width: 260px;
            min-height: 520px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        
        .tool-card:hover {
            box-shadow: 0 8px 32px 0 rgba(30,40,80,0.18);
            border: 2px solid #4F46E5;
        }
        
        .tool-thumbnail {
            height: 100px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #29304a;
            border-radius: 1rem !important;
            overflow: hidden;
            margin-bottom: 0.1rem;
        }
        
        .tool-thumbnail img {
            width: 70px;
            height: 68px;
            object-fit: cover;
            border-radius: 0.75rem;
            background: #29304a;
            display: block;
            margin: 0 auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
        }
        
        .tool-card:hover .tool-thumbnail img {
            transform: scale(1.05);
        }
        
        .tool-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        
        .tool-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .tool-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #fff;
            margin-top: 0;
            margin-bottom: 0.25rem;
        }
        
        .bookmark-icon {
            color: #4F46E5;
            font-size: 1.3rem;
            margin-left: 0.5rem;
            margin-top: 0.1rem;
        }
        
        .tool-description {
            color: #a0aec0;
            font-size: 0.98rem;
            margin-bottom: 0.75rem;
            min-height: 40px;
        }
        
        .tag {
            background-color: #232939;
            color: #7dd3fc;
            font-size: 0.78rem;
            padding: 0.18rem 0.7rem;
            border-radius: 0.5rem;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
            display: inline-block;
        }
        
        .tool-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.2rem;
        }
        
        .remove-btn {
            background: #ef4444;
            color: #fff;
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 500;
            height: 40px; /* 고정 높이 설정 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 레시피 요약 보기 버튼과 동일한 높이 설정 */
        .btn-primary {
            height: 40px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .remove-btn:hover {
            background: #b91c1c;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background-color: var(--card-bg);
            border-radius: 0.5rem;
        }

        .stars {
            color: #FFD700;
            letter-spacing: -1px;
        }

        .glass-effect {
            background: rgba(26, 31, 46, 0.85); /* 반투명 효과 */
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px); /* 블러 효과 강화 */
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 2px 8px 0 rgba(0,0,0,0.10);
        }

        /* 화이트 테마 카드/썸네일/입력/태그 스타일 */
        [data-theme="light"] .tool-card {
            background: none !important;
            border: 1.5px solid #9CB6D7 !important;
            color: #1a202c !important;
        }
        [data-theme="light"] .tool-thumbnail {
            background: #f3f4f6 !important;
            border: 1.5px solid #9CB6D7 !important;
        }
        [data-theme="light"] input[type="text"],
        [data-theme="light"] input[type="email"] {
            background: none !important;
            border: 1.5px solid #9CB6D7 !important;
            color: #1a202c !important;
        }
        [data-theme="light"] .tag {
            background: #f3f4f6 !important;
            color: #4a5568 !important;
            border: 1px solid #9CB6D7 !important;
        }
        /* 태그 색상 total_page.html 스타일(blue 계열) */
        .tag.bg-blue-600 { background: #2563eb !important; color: #fff !important; border: none !important; }
        .tag.bg-green-600 { background: #16a34a !important; color: #fff !important; border: none !important; }
        .tag.bg-purple-600 { background: #7c3aed !important; color: #fff !important; border: none !important; }
        .tag.bg-red-600 { background: #dc2626 !important; color: #fff !important; border: none !important; }
        .tag.bg-yellow-600 { background: #ca8a04 !important; color: #fff !important; border: none !important; }
        .tag.bg-pink-600 { background: #db2777 !important; color: #fff !important; border: none !important; }
        .tag.bg-indigo-600 { background: #4f46e5 !important; color: #fff !important; border: none !important; }
        .tag.bg-teal-600 { background: #0d9488 !important; color: #fff !important; border: none !important; }
        [data-theme="light"] .profile-settings-title {
            color: #2563eb !important;
        }
        /* 태그 영역 2줄 제한 */
        .tool-card .tag-list-clamp {
            display: -webkit-box;
            -webkit-line-clamp: 2;
             line-clamp: 2;  
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: 3.8em; /* 2줄 높이로 제한 (태그 크기에 따라 조정) */
        }

        /* AI 레시피 카드 스타일 */
        .recipe-card {
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            word-wrap: break-word;
            height: 380px; /* 균형감 있는 높이로 조정 */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .recipe-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            background: var(--card-hover);
            border-color: #3b82f6;
        }
        .recipe-card:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .recipe-tool-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
        }
        
        .recipe-tool-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 4px;
            max-width: 100%;
            max-height: 100%;
        }
        
        .recipe-tool-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 0;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .recipe-tool-name {
            font-size: 8px;
            color: var(--text-secondary);
            margin-top: 3px;
            max-width: 45px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: center;
        }
        .recipe-arrow {
            font-size: 12px;
            color: #9CA3AF;
            flex-shrink: 0;
        }
        .recipe-user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* 화이트 테마 레시피 카드 스타일 */
        [data-theme="light"] .recipe-card {
            background: #ffffff !important;
            border: 1.5px solid #9CB6D7 !important;
            color: #1a202c !important;
        }
        [data-theme="light"] .recipe-card:hover {
            background: #f8fafc !important;
            border-color: #3b82f6 !important;
        }
    </style>
    <script>
    window.DEFAULT_IMAGE = 'assets/icons/code-icon1.png';
    function getStorageUrl(fileName) {
        return `https://firebasestorage.googleapis.com/v0/b/ai-tools-data-b2b7b.firebasestorage.app/o/ai_logos%2F${encodeURIComponent(fileName)}?alt=media&token=4b780bb4-d39d-4195-8c73-4766eda6ad6b`;
    }
    function getValidImageUrl(tool) {
        if (typeof tool.logoUrl === 'string' && tool.logoUrl.trim() !== '') return tool.logoUrl;
        if (typeof tool.logoFileName === 'string' && tool.logoFileName.trim() !== '') {
            return getStorageUrl(tool.logoFileName);
        }
        if (typeof tool.imageUrl === 'string' && tool.imageUrl.trim() !== '') return tool.imageUrl;
        if (typeof tool.image === 'string' && tool.image.trim() !== '') return tool.image;
        return window.DEFAULT_IMAGE;
    }
    // 이미지 로드 실패 시 기본 이미지로 대체
    window.handleImageError = function(img) {
        img.onerror = null;
        img.src = window.DEFAULT_IMAGE;
    };
    </script>
</head>
<body class="bg-[var(--dark-bg)] text-white">
    <!-- header.html 포함 -->
    <div id="header-container"></div>
    <script>
        // 테마 적용 (공통)
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.body.setAttribute('data-theme', savedTheme);
        });
        // 헤더 fetch 및 삽입 (공통)
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const script = document.createElement('script');
                script.src = 'js/header-menu.js';
                script.onload = function() {
                    if (window.initProfileMenuDropdown) window.initProfileMenuDropdown();
                    if (window.initMobileMenuToggle) window.initMobileMenuToggle();
                    if (window.SimpleThemeToggle) new window.SimpleThemeToggle();
                };
                document.body.appendChild(script);
            });
    </script>

    <!-- Profile Section -->
    <main class="container mx-auto px-4 py-8 mt-24">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Column - Profile Info -->
            <div class="md:col-span-1">
                <div class="bg-[var(--card-bg)] rounded-lg p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-20 h-20 bg-indigo-500 rounded-full flex items-center justify-center text-2xl font-bold mr-4">
                            <span id="profileInitialLarge">U</span>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold" id="profileNameDisplay">사용자</h2>
                            <p class="text-gray-400" id="profileEmail">loading...</p>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="text-2xl font-bold text-indigo-500" id="favoriteToolsCount">0</div>
                            <div class="text-sm text-gray-400">AI 도구</div>
                        </div>
                        <div class="stat-item">
                            <div class="text-2xl font-bold text-indigo-500" id="favoriteRecipesCount">0</div>
                            <div class="text-sm text-gray-400">AI 레시피</div>
                        </div>
                        <div class="stat-item">
                            <div class="text-2xl font-bold text-indigo-500">0</div>
                            <div class="text-sm text-gray-400">리뷰</div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h3 class="profile-settings-title text-lg font-semibold mb-4">계정 설정</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">이름</label>
                                <input type="text" id="displayName" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">이메일</label>
                                <input type="email" id="email" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2" disabled>
                            </div>
                            <button id="saveChanges" class="w-full bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors">
                                변경사항 저장
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Favorite Tools -->
            <div class="md:col-span-2">
                <!-- 탭 네비게이션 -->
                <div class="flex space-x-1 mb-6 bg-gray-700 rounded-lg p-1">
                    <button id="favoriteToolsTab" class="flex-1 py-2 px-4 rounded-md bg-indigo-500 text-white font-medium transition-colors">
                        즐겨찾기한 AI 도구
                    </button>
                    <button id="favoriteRecipesTab" class="flex-1 py-2 px-4 rounded-md bg-gray-600 text-gray-300 font-medium hover:bg-gray-500 transition-colors">
                        즐겨찾기한 AI 레시피
                    </button>
                </div>

                <!-- AI 도구 탭 -->
                <div id="favoriteToolsSection">
                    <h2 class="text-2xl font-bold mb-6">즐겨찾기한 AI 도구</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="favoriteToolsContainer">
                        <!-- Favorite tools will be dynamically added here -->
                    </div>
                </div>

                <!-- AI 레시피 탭 -->
                <div id="favoriteRecipesSection" class="hidden">
                    <h2 class="text-2xl font-bold mb-6">즐겨찾기한 AI 레시피</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6" id="favoriteRecipesContainer">
                        <!-- Favorite recipes will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- footer.html 포함 -->
    <div id="footer-container"></div>
    <script>
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });
    </script>

    <!-- 모바일 메뉴 (숨김 상태로 시작) -->
    <div id="mobileMenu" class="fixed top-0 right-0 w-64 h-full bg-gray-900 z-50 shadow-lg transform translate-x-full transition-transform duration-300 md:hidden">
        <div class="flex justify-end p-4">
            <button id="closeMobileMenu" class="text-gray-300 text-2xl">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="flex flex-col space-y-4 px-6">
            <button onclick="location.href='question_recommendation.html'" class="text-gray-300 text-left">AI 추천 테스트</button>
            <button onclick="location.href='filter_search.html'" class="text-gray-300 text-left">AI 도구 찾기</button>
            <button onclick="showLoginModal()" class="text-gray-300 text-left">로그인</button>
            <button onclick="showSignupModal()" class="text-gray-300 text-left">회원가입</button>
            <button id="mobileThemeToggle" class="text-gray-300 text-left">테마 변경</button>
        </nav>
    </div>

    <style>
    [data-theme="light"] #mobileMenu {
        background-color: #fff !important;
    }
    [data-theme="light"] #mobileMenu button,
    [data-theme="light"] #mobileMenu nav button {
        color: #222 !important;
    }
    [data-theme="light"] #mobileMenu #closeMobileMenu {
        color: #222 !important;
    }
    [data-theme="light"] footer {
        background-color: #fff !important;
        color: #222 !important;
    }
    [data-theme="light"] footer h3,
    [data-theme="light"] footer a,
    [data-theme="light"] footer p,
    [data-theme="light"] footer li,
    [data-theme="light"] footer span {
        color: #222 !important;
    }
            [data-theme="light"] footer .border-gray-800 {
            border-color: #e5e7eb !important;
        }
        [data-theme="light"] #favoriteToolsTab,
        [data-theme="light"] #favoriteRecipesTab {
            color: #1a202c !important;
        }
        [data-theme="light"] #favoriteToolsTab.bg-indigo-500 {
            background-color: #4f46e5 !important;
            color: #ffffff !important;
        }
        [data-theme="light"] #favoriteRecipesTab.bg-indigo-500 {
            background-color: #4f46e5 !important;
            color: #ffffff !important;
        }
    </style>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const openBtn = document.getElementById('openMobileMenu');
        const closeBtn = document.getElementById('closeMobileMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileThemeToggle = document.getElementById('mobileThemeToggle');

        if (openBtn && mobileMenu) {
            openBtn.addEventListener('click', function() {
                mobileMenu.classList.remove('translate-x-full');
                mobileMenu.classList.add('translate-x-0');
                document.body.style.overflow = 'hidden';
            });
        }
        if (closeBtn && mobileMenu) {
            closeBtn.addEventListener('click', function() {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('translate-x-full');
                document.body.style.overflow = '';
            });
        }
        // 바깥 영역 클릭 시 닫기
        mobileMenu.addEventListener('click', function(e) {
            if (e.target === mobileMenu) {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('translate-x-full');
                document.body.style.overflow = '';
            }
        });
        // 모바일 테마 변경 버튼 동작 추가
        if (mobileThemeToggle) {
            mobileThemeToggle.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                // 아이콘도 변경 (PC와 동일하게)
                const themeIcon = document.querySelector('#themeToggle i');
                if (themeIcon) {
                    if (newTheme === 'dark') {
                        themeIcon.className = 'fas fa-sun';
                    } else {
                        themeIcon.className = 'fas fa-moon';
                    }
                }
            });
        }
    });
    </script>

    <!-- Firebase SDK 스크립트 -->
    <script type="module">
        // Firebase SDK 임포트
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { 
            getAuth, 
            signOut,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, collection, getDocs, doc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        import { firebaseConfig } from '../config.js';

        // Firebase 초기화
        let app;
        try {
            app = initializeApp(firebaseConfig);
        } catch (error) {
            if (error.code !== 'app/duplicate-app') {
                console.error('Firebase 초기화 오류:', error);
                throw error;
            }
        }

        const auth = getAuth(app);
        const db = getFirestore(app);

        // 탭 전환 함수
        function switchTab(tabName) {
            const toolsTab = document.getElementById('favoriteToolsTab');
            const recipesTab = document.getElementById('favoriteRecipesTab');
            const toolsSection = document.getElementById('favoriteToolsSection');
            const recipesSection = document.getElementById('favoriteRecipesSection');

            if (tabName === 'tools') {
                toolsTab.className = 'flex-1 py-2 px-4 rounded-md bg-indigo-500 text-white font-medium transition-colors';
                recipesTab.className = 'flex-1 py-2 px-4 rounded-md bg-gray-600 text-gray-300 font-medium hover:bg-gray-500 transition-colors';
                toolsSection.classList.remove('hidden');
                recipesSection.classList.add('hidden');
            } else {
                toolsTab.className = 'flex-1 py-2 px-4 rounded-md bg-gray-600 text-gray-300 font-medium hover:bg-gray-500 transition-colors';
                recipesTab.className = 'flex-1 py-2 px-4 rounded-md bg-indigo-500 text-white font-medium transition-colors';
                toolsSection.classList.add('hidden');
                recipesSection.classList.remove('hidden');
            }
        }

        // 로그인 상태 감지
        onAuthStateChanged(auth, (user) => {
            const authButtons = document.getElementById('authButtons');
            const profileMenu = document.getElementById('profileMenu');
            if (user) {
                // 헤더 토글: 로그인 시
                if (authButtons) authButtons.style.display = 'none';
                if (profileMenu) profileMenu.style.display = 'flex';
                // 사용자 프로필 정보 표시 (안전하게)
                const profileNameDisplay = document.getElementById('profileNameDisplay');
                const profileEmail = document.getElementById('profileEmail');
                const profileInitialLarge = document.getElementById('profileInitialLarge');
                const displayNameInput = document.getElementById('displayName');
                const emailInput = document.getElementById('email');
                
                if (profileNameDisplay) {
                    profileNameDisplay.textContent = user.displayName || user.email.split('@')[0];
                }
                if (profileEmail) {
                    profileEmail.textContent = user.email;
                }
                if (profileInitialLarge) {
                    profileInitialLarge.textContent = (user.displayName || user.email)[0].toUpperCase();
                }
                if (displayNameInput) {
                    displayNameInput.value = user.displayName || '';
                }
                if (emailInput) {
                    emailInput.value = user.email;
                }

                // 탭 이벤트 리스너 설정 (안전하게 설정)
                const toolsTab = document.getElementById('favoriteToolsTab');
                const recipesTab = document.getElementById('favoriteRecipesTab');
                
                if (toolsTab) {
                    toolsTab.addEventListener('click', () => switchTab('tools'));
                }
                if (recipesTab) {
                    recipesTab.addEventListener('click', () => switchTab('recipes'));
                }

                // 즐겨찾기 도구 표시 (Firestore에서 불러오기)
                const favoriteToolsContainer = document.getElementById('favoriteToolsContainer');
                favoriteToolsContainer.innerHTML = '';
                function createToolCard(tool, toolId) {
                    return `
                        <div class="tool-card">
                            <div class="tool-thumbnail">
                                <img src="${getValidImageUrl(tool)}" alt="${tool.name}" onerror="window.handleImageError(this)">
                            </div>
                            <div class="tool-content">
                                <div class="tool-header">
                                    <div class="tool-title">${tool.name}</div>
                                    <i class="fas fa-bookmark bookmark-icon" title="즐겨찾기됨"></i>
                                </div>
                                <p class="tool-description">${tool.description}</p>
                                <div class="flex flex-wrap gap-2 mb-2 tag-list-clamp">
                                    ${(tool.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                                <!-- 버튼 추가 영역 -->
                                <div class="flex gap-2 mb-2">
                                    <a href="${tool.websiteUrl || '#'}" target="_blank" class="flex-1 bg-indigo-500 text-white px-2 py-1 rounded hover:bg-indigo-600 text-center">웹사이트 방문</a>
                                    <button class="flex-1 bg-gray-700 text-white px-2 py-1 rounded hover:bg-gray-600" onclick="shareTool('${tool.name}', '${tool.websiteUrl || ''}')">공유하기</button>
                                </div>
                                <button class="btn-primary w-full mt-2" onclick="location.href='detail_sp.html?id=${toolId}'">상세 정보 페이지 이동</button>
                                <div class="tool-footer">
                                    <span class="text-sm font-medium text-gray-300">${tool.type}</span>
                                    <span class="text-sm text-gray-400">${tool.reviewCount || 0} reviews</span>
                                    <button class="remove-btn" onclick="removeFavoriteTool('${toolId}')">삭제</button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // AI 레시피 카드 생성 함수
                function createRecipeCard(recipeData, docId) {
                    const card = document.createElement('div');
                    card.className = 'recipe-card p-4 sm:p-6';
                    // 카드 크기 제한 제거 - CSS에서 통일된 크기 적용
                    
                    // 카드 클릭 이벤트 추가
                    card.style.cursor = 'pointer';
                    card.addEventListener('click', function(e) {
                        // 버튼 클릭 시에는 상세 페이지로 이동하지 않음
                        if (e.target.closest('button')) {
                            return;
                        }
                        // 상세 페이지로 이동
                        window.location.href = `ai_comb_detail.html?id=${docId}`;
                    });
                    
                    // 사용자 아바타 (첫 글자 사용)
                    const userName = recipeData.user_id ? recipeData.user_id.substring(0, 1) : 'U';
                    const avatarColor = getAvatarColor(recipeData.user_id);
                    
                    // Firestore 데이터 구조에 맞춰 필드명 수정
                    const recipeTitle = recipeData.title || recipeData.my_recipe_title || 'Untitled Recipe';
                    const recipeDescription = recipeData.description || recipeData.my_recipe_basic_description || '';
                    const tools = recipeData.tools || recipeData.my_recipe_tool || [];
                    
                    // 도구 아이콘과 이름 생성 (최대 4개까지 표시, 초과 시 3개만 표시)
                    const maxTools = tools.length > 4 ? 3 : 4;
                    const displayTools = tools.slice(0, maxTools);
                    let toolElements = displayTools.map((tool, index) => {
                        const toolImage = window.toolImagesCache ? window.toolImagesCache[tool] : null;
                        const bgColor = getToolColor(tool);
                        
                        let toolIcon;
                        if (toolImage) {
                            // DB에서 가져온 이미지가 있는 경우
                            toolIcon = `
                                <div class="recipe-tool-icon ${bgColor}" style="padding: 2px;">
                                    <img src="${toolImage}" alt="${tool}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 4px; max-width: 100%; max-height: 100%;" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'${getToolIcon(tool)}\\'></i>';">
                                </div>
                            `;
                        } else {
                            // 기본 아이콘 사용
                            const iconClass = getToolIcon(tool);
                            toolIcon = `
                                <div class="recipe-tool-icon ${bgColor}">
                                    <i class="${iconClass}"></i>
                                </div>
                            `;
                        }
                        
                        return `
                            <div class="recipe-tool-container">
                                ${toolIcon}
                                <div class="recipe-tool-name">${tool}</div>
                            </div>
                            ${index < displayTools.length - 1 ? '<i class="fas fa-arrow-right recipe-arrow mx-1"></i>' : ''}
                        `;
                    }).join('');

                    // 4개를 초과하는 도구가 있을 경우 추가 표시
                    const additionalToolsCount = tools.length - maxTools;
                    if (tools.length > 4) {
                        toolElements += `
                            <i class="fas fa-arrow-right recipe-arrow mx-1"></i>
                            <div class="recipe-tool-container">
                                <div class="recipe-tool-icon bg-gray-500 flex items-center justify-center">
                                    <span class="text-xs font-bold">+${additionalToolsCount}</span>
                                </div>
                                <div class="recipe-tool-name">추가</div>
                            </div>
                        `;
                    }

                    card.innerHTML = `
                        <div class="flex-1">
                            <div class="text-left mb-10">
                                <h3 class="text-lg font-semibold mb-3 line-clamp-2" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.4; color: var(--text-primary);">${recipeTitle}</h3>
                                <p class="text-sm text-gray-400 line-clamp-3" style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.4;">${recipeDescription}</p>
                            </div>
                            
                            <div class="flex items-center justify-center mb-6 overflow-hidden">
                                ${toolElements}
                            </div>
                            
                            <div class="flex items-center justify-center space-x-4 text-sm mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-heart text-red-500 mr-1"></i>
                                    <span>${recipeData.likes_count || 0}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-comment text-blue-500 mr-1"></i>
                                    <span>${recipeData.comments_count || 0}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-bookmark text-yellow-500 mr-1"></i>
                                    <span>${recipeData.bookmarks_count || 0}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-2 mt-auto">
                            <button class="btn-primary text-sm px-4 py-2 flex-1" onclick="event.stopPropagation(); showRecipeSummary('${docId}', ${JSON.stringify(recipeData).replace(/"/g, '&quot;')})">
                                레시피 요약
                            </button>
                            <button class="remove-btn text-sm px-4 py-2 flex-1" onclick="event.stopPropagation(); removeFavoriteRecipe('${docId}')">
                                삭제
                            </button>
                        </div>
                    `;

                    return card;
                }

                // Firestore에서 즐겨찾기 도구 불러오기
                (async () => {
                    try {
                        const favoritesCol = collection(db, `users/${user.uid}/favorites`);
                        const favoriteSnapshot = await getDocs(favoritesCol);
                        const favoriteToolsCountElem = document.getElementById('favoriteToolsCount');
                        const favoriteToolsContainer = document.getElementById('favoriteToolsContainer');
                        
                        if (favoriteToolsCountElem) {
                            favoriteToolsCountElem.textContent = favoriteSnapshot.size;
                        }
                        
                        if (favoriteSnapshot.empty) {
                            if (favoriteToolsContainer) {
                                favoriteToolsContainer.innerHTML = '<div class="text-gray-400">저장한 도구가 없습니다.</div>';
                            }
                        } else {
                            favoriteSnapshot.forEach(docSnap => {
                                const tool = docSnap.data();
                                if (favoriteToolsContainer) {
                                    favoriteToolsContainer.innerHTML += createToolCard({
                                        name: tool.name,
                                        description: tool.description,
                                        image: tool.imageUrl,
                                        rating: tool.rating || 0,
                                        reviewCount: tool.reviewCount || 0,
                                        tags: tool.tags || [],
                                        type: tool.priceType || '',
                                        websiteUrl: tool.websiteUrl || '',
                                        logoUrl: tool.logoUrl || '',
                                        logoFileName: tool.logoFileName || ''
                                    }, docSnap.id);
                                }
                            });
                        }
                    } catch (error) {
                        console.error('즐겨찾기 도구 로드 오류:', error);
                        const favoriteToolsCountElem = document.getElementById('favoriteToolsCount');
                        const favoriteToolsContainer = document.getElementById('favoriteToolsContainer');
                        
                        if (favoriteToolsCountElem) {
                            favoriteToolsCountElem.textContent = '0';
                        }
                        if (favoriteToolsContainer) {
                            favoriteToolsContainer.innerHTML = '<div class="text-gray-400">도구를 불러오는 중 오류가 발생했습니다.</div>';
                        }
                    }
                })();

                // Firestore에서 즐겨찾기 레시피 불러오기
                (async () => {
                    try {
                        // AI 도구 정보 로드
                        await loadToolImages();
                        
                        const favoriteRecipesContainer = document.getElementById('favoriteRecipesContainer');
                        const favoriteRecipesCountElem = document.getElementById('favoriteRecipesCount');
                        
                        // 컬렉션 존재 여부 확인을 위한 안전한 접근
                        try {
                            const favoriteRecipesCol = collection(db, `users/${user.uid}/favorited_recipe`);
                            const favoriteRecipesSnapshot = await getDocs(favoriteRecipesCol);
                            
                            favoriteRecipesCountElem.textContent = favoriteRecipesSnapshot.size;
                            
                            if (favoriteRecipesSnapshot.empty) {
                                favoriteRecipesContainer.innerHTML = '<div class="col-span-full text-center py-8 text-gray-400"><i class="fas fa-bookmark text-4xl mb-4 opacity-50"></i><p class="text-lg">저장한 레시피가 없습니다.</p></div>';
                            } else {
                                favoriteRecipesSnapshot.forEach(docSnap => {
                                    const recipeData = docSnap.data();
                                    recipeData.docId = docSnap.id;
                                    const recipeCard = createRecipeCard(recipeData, docSnap.id);
                                    favoriteRecipesContainer.appendChild(recipeCard);
                                });
                            }
                        } catch (firestoreError) {
                            // 권한 오류 또는 컬렉션이 존재하지 않는 경우
                            console.log('즐겨찾기 레시피 컬렉션이 존재하지 않거나 접근 권한이 없습니다. 새로 생성합니다.');
                            favoriteRecipesCountElem.textContent = '0';
                            favoriteRecipesContainer.innerHTML = '<div class="col-span-full text-center py-8 text-gray-400"><i class="fas fa-bookmark text-4xl mb-4 opacity-50"></i><p class="text-lg">저장한 레시피가 없습니다.</p><p class="text-sm mt-2">AI 레시피를 즐겨찾기에 추가하면 여기에 표시됩니다.</p></div>';
                        }
                    } catch (error) {
                        console.error('즐겨찾기 레시피 로드 오류:', error);
                        const favoriteRecipesContainer = document.getElementById('favoriteRecipesContainer');
                        const favoriteRecipesCountElem = document.getElementById('favoriteRecipesCount');
                        
                        if (favoriteRecipesCountElem) {
                            favoriteRecipesCountElem.textContent = '0';
                        }
                        if (favoriteRecipesContainer) {
                            favoriteRecipesContainer.innerHTML = '<div class="col-span-full text-center py-8 text-gray-400"><p class="text-lg">레시피를 불러오는 중 오류가 발생했습니다.</p><p class="text-sm mt-2">잠시 후 다시 시도해주세요.</p></div>';
                        }
                    }
                })();

                // 변경사항 저장 버튼 이벤트 리스너
                const saveChangesBtn = document.getElementById('saveChanges');
                if (saveChangesBtn) {
                    saveChangesBtn.addEventListener('click', async () => {
                        try {
                            const displayNameInput = document.getElementById('displayName');
                            const newDisplayName = displayNameInput ? displayNameInput.value : '';
                            // Firestore에 이름만 업데이트하려면 users/{uid} 문서에 setDoc 사용 가능
                            // 여기서는 RTDB 예시이므로 필요시 Firestore로 변경
                            // await setDoc(doc(db, 'users', user.uid), { displayName: newDisplayName }, { merge: true });
                            alert('프로필이 업데이트되었습니다.');
                        } catch (error) {
                            console.error('프로필 업데이트 실패:', error);
                            alert('프로필 업데이트 중 오류가 발생했습니다.');
                        }
                    });
                }
            } else {
                // 헤더 토글: 로그아웃 시
                if (authButtons) authButtons.style.display = 'flex';
                if (profileMenu) profileMenu.style.display = 'none';
                // 로그인되지 않은 경우 홈페이지로 리다이렉트
                window.location.href = 'index.html';
            }
        });

        // 로그아웃 함수
        window.handleLogout = async function() {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('로그아웃 실패:', error);
                alert('로그아웃 중 오류가 발생했습니다.');
            }
        };

        // AI 도구 정보 로드 함수
        async function loadToolImages() {
            try {
                const toolsRef = collection(db, 'ai-tools');
                const toolsSnapshot = await getDocs(toolsRef);
                
                window.toolImagesCache = {};
                window.toolInfoCache = {};
                
                toolsSnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.name) {
                        // 이미지 URL 저장
                        if (data.imageUrl) {
                            window.toolImagesCache[data.name] = data.imageUrl;
                        }
                        
                        // 도구 정보 저장
                        window.toolInfoCache[data.name] = {
                            description: data.description || `${data.name}은 다양한 작업을 지원하는 AI 도구입니다.`,
                            category: data.category || '',
                            difficulty: data.difficulty || '',
                            websiteUrl: data.websiteUrl || '',
                            tags: data.tags || []
                        };
                    }
                });
                
                console.log(`${Object.keys(window.toolInfoCache).length}개의 AI 도구 정보를 로드했습니다.`);
            } catch (error) {
                console.error('AI 도구 정보 로드 오류:', error);
                // 오류가 발생해도 기본 캐시 객체는 생성
                window.toolImagesCache = {};
                window.toolInfoCache = {};
            }
        }

        // 아바타 색상 생성 함수
        function getAvatarColor(userId) {
            const colors = ['bg-purple-500', 'bg-blue-500', 'bg-red-500', 'bg-yellow-500', 'bg-pink-500', 'bg-green-500'];
            if (!userId) return colors[0];
            const hash = userId.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            return colors[Math.abs(hash) % colors.length];
        }

        // 도구 색상 생성 함수
        function getToolColor(toolName) {
            const colors = ['bg-green-500', 'bg-blue-500', 'bg-purple-500', 'bg-red-500', 'bg-yellow-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'];
            if (!toolName) return colors[0];
            const hash = toolName.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            return colors[Math.abs(hash) % colors.length];
        }

        // 도구 아이콘 매핑 함수
        function getToolIcon(toolName) {
            const iconMap = {
                'ChatGPT': 'fas fa-comments',
                'Notion AI': 'fas fa-note-sticky',
                'Midjourney': 'fas fa-palette',
                'Claude': 'fas fa-robot',
                'Google Sheets': 'fas fa-table',
                'Zapier': 'fas fa-bolt',
                'Whisper': 'fas fa-microphone-lines',
                'Descript': 'fas fa-edit',
                'Adobe Podcast': 'fas fa-podcast',
                'Hugging Face': 'fas fa-face-smile',
                'Grammarly': 'fas fa-check',
                'Copy.ai': 'fas fa-copy',
                'DALL-E': 'fas fa-image',
                'Upscayl': 'fas fa-magic',
                'Photoshop': 'fas fa-paint-brush',
                'GitHub Copilot': 'fas fa-code',
                'Canva': 'fas fa-palette',
                'Figma': 'fas fa-paint-brush',
                'Slack': 'fas fa-comments',
                'Discord': 'fas fa-comments',
                'Zoom': 'fas fa-video',
                'Google Meet': 'fas fa-video',
                'Microsoft Teams': 'fas fa-users',
                'Trello': 'fas fa-tasks',
                'Asana': 'fas fa-tasks',
                'Notion': 'fas fa-sticky-note',
                'Airtable': 'fas fa-table',
                'Typeform': 'fas fa-poll',
                'SurveyMonkey': 'fas fa-poll',
                'Mailchimp': 'fas fa-envelope',
                'HubSpot': 'fas fa-chart-line',
                'Salesforce': 'fas fa-chart-line',
                'Stripe': 'fas fa-credit-card',
                'PayPal': 'fas fa-credit-card',
                'Shopify': 'fas fa-shopping-cart',
                'WooCommerce': 'fas fa-shopping-cart',
                'WordPress': 'fas fa-wordpress',
                'Squarespace': 'fas fa-square',
                'Wix': 'fas fa-wix',
                'Webflow': 'fas fa-globe',
                'Framer': 'fas fa-paint-brush',
                'Webflow': 'fas fa-globe',
                'Bubble': 'fas fa-bubble',
                'Glide': 'fas fa-mobile',
                'Adalo': 'fas fa-mobile',
                'Outseta': 'fas fa-users',
                'Memberstack': 'fas fa-users',
                'Kajabi': 'fas fa-graduation-cap',
                'Teachable': 'fas fa-graduation-cap',
                'Thinkific': 'fas fa-graduation-cap',
                'Podia': 'fas fa-graduation-cap',
                'ConvertKit': 'fas fa-envelope',
                'ActiveCampaign': 'fas fa-envelope',
                'Klaviyo': 'fas fa-envelope',
                'Drip': 'fas fa-envelope',
                'Kajabi': 'fas fa-graduation-cap',
                'Teachable': 'fas fa-graduation-cap',
                'Thinkific': 'fas fa-graduation-cap',
                'Podia': 'fas fa-graduation-cap',
                'ConvertKit': 'fas fa-envelope',
                'ActiveCampaign': 'fas fa-envelope',
                'Klaviyo': 'fas fa-envelope',
                'Drip': 'fas fa-envelope',
                'Kajabi': 'fas fa-graduation-cap',
                'Teachable': 'fas fa-graduation-cap',
                'Thinkific': 'fas fa-graduation-cap',
                'Podia': 'fas fa-graduation-cap',
                'ConvertKit': 'fas fa-envelope',
                'ActiveCampaign': 'fas fa-envelope',
                'Klaviyo': 'fas fa-envelope',
                'Drip': 'fas fa-envelope'
            };
            
            return iconMap[toolName] || 'fas fa-cog';
        }

        // 레시피 요약 모달 표시 함수
        window.showRecipeSummary = function(docId, recipeData) {
            const modal = document.getElementById('recipeSummaryModal');
            const title = document.getElementById('recipeSummaryTitle');
            const content = document.getElementById('recipeSummaryContent');
            
            if (modal && title && content) {
                // Firestore 데이터 구조에 맞춰 필드명 수정
                const recipeTitle = recipeData.title || recipeData.my_recipe_title || '레시피 제목 없음';
                const recipeDescription = recipeData.description || recipeData.my_recipe_basic_description || '설명이 없습니다.';
                const tools = recipeData.tools || recipeData.my_recipe_tool || [];
                const category = recipeData.category || recipeData.my_recipe_category || '카테고리 없음';
                const difficulty = recipeData.difficulty || recipeData.my_recipe_difficulty || '난이도 정보 없음';
                const recommendedGroups = recipeData.recommendedGroups || recipeData.my_recipe_recommended_groups || [];
                
                title.textContent = recipeTitle;
                
                const toolList = tools.map(tool => `<li class="mb-2"><i class="fas fa-check text-green-500 mr-2"></i>${tool}</li>`).join('');
                
                content.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold mb-2">레시피 설명</h3>
                            <p class="text-sm text-gray-600">${recipeDescription}</p>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold mb-2">사용된 AI 도구</h3>
                            <ul class="list-none space-y-1">
                                ${toolList}
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold mb-2">카테고리</h3>
                            <p class="text-sm text-gray-600">${category}</p>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold mb-2">난이도</h3>
                            <p class="text-sm text-gray-600">${difficulty}</p>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold mb-2">추천 대상</h3>
                            <p class="text-sm text-gray-600">${recommendedGroups.join(', ') || '추천 대상 정보 없음'}</p>
                        </div>
                        
                        <div class="flex justify-end space-x-2 pt-4">
                            <button onclick="closeRecipeSummary()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                                닫기
                            </button>
                            <button onclick="location.href='ai_comb_detail.html?id=${docId}'" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                                상세 보기
                            </button>
                        </div>
                    </div>
                `;
                
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        };

        // 레시피 요약 모달 닫기 함수
        window.closeRecipeSummary = function() {
            const modal = document.getElementById('recipeSummaryModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        };

        // 즐겨찾기 삭제 함수 (Firestore용)
        window.removeFavoriteTool = async function(toolId) {
            if (!confirm('정말로 이 도구를 즐겨찾기에서 삭제하시겠습니까?')) return;
            const user = auth.currentUser;
            if (!user) return;
            const db = getFirestore(app);
            const favDocRef = doc(db, `users/${user.uid}/favorites/${toolId}`);
            try {
                await deleteDoc(favDocRef);
                window.location.reload();
            } catch (e) {
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        // 즐겨찾기 레시피 삭제 함수
        window.removeFavoriteRecipe = async function(recipeId) {
            if (!confirm('정말로 이 레시피를 즐겨찾기에서 삭제하시겠습니까?')) return;
            const user = auth.currentUser;
            if (!user) return;
            
            try {
                const db = getFirestore(app);
                const favDocRef = doc(db, `users/${user.uid}/favorited_recipe/${recipeId}`);
                await deleteDoc(favDocRef);
                window.location.reload();
            } catch (e) {
                console.error('레시피 삭제 오류:', e);
                if (e.code === 'permission-denied') {
                    alert('삭제 권한이 없습니다. 관리자에게 문의하세요.');
                } else {
                    alert('삭제 중 오류가 발생했습니다.');
                }
            }
        }

        // 공유하기 함수
        window.shareTool = function(name, url) {
            window._shareUrl = url;
            window._shareName = name;
            document.getElementById('shareModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    </script>

    <!-- 공유하기 모달 -->
    <div id="shareModal" class="modal-overlay" style="display:none;">
      <div class="modal">
        <div class="modal-close" onclick="closeShareModal()">
          <i class="fas fa-times"></i>
        </div>
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-white">공유하기</h2>
        </div>
        <div class="grid grid-cols-4 gap-4 mb-4">
          <button onclick="shareEmail()" class="flex flex-col items-center">
            <span class="bg-blue-400 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fas fa-envelope text-white text-xl"></i></span>
            <span class="text-xs text-white">메일</span>
          </button>
          <button onclick="shareReddit()" class="flex flex-col items-center">
            <span class="bg-orange-500 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-reddit text-white text-xl"></i></span>
            <span class="text-xs text-white">Reddit</span>
          </button>
          <button onclick="shareWhatsApp()" class="flex flex-col items-center">
            <span class="bg-green-500 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-whatsapp text-white text-xl"></i></span>
            <span class="text-xs text-white">WhatsApp</span>
          </button>
          <button onclick="shareSms()" class="flex flex-col items-center">
            <span class="bg-green-300 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fas fa-sms text-white text-xl"></i></span>
            <span class="text-xs text-white">메시지</span>
          </button>
          <button onclick="shareX()" class="flex flex-col items-center">
            <span class="bg-black rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-x-twitter text-white text-xl"></i></span>
            <span class="text-xs text-white">X</span>
          </button>
          <button onclick="shareFacebook()" class="flex flex-col items-center">
            <span class="bg-blue-700 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-facebook-f text-white text-xl"></i></span>
            <span class="text-xs text-white">Facebook</span>
          </button>
          <button onclick="shareLine()" class="flex flex-col items-center">
            <span class="bg-green-600 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fab fa-line text-white text-xl"></i></span>
            <span class="text-xs text-white">Line</span>
          </button>
          <button onclick="shareKakao()" class="flex flex-col items-center">
            <span class="bg-yellow-400 rounded-full w-12 h-12 flex items-center justify-center mb-1"><i class="fas fa-comment text-white text-xl"></i></span>
            <span class="text-xs text-white">카카오톡</span>
          </button>
        </div>
        <button onclick="copyShareLink()" class="w-full flex items-center bg-gray-700 text-white px-4 py-2 rounded mb-2">
          <i class="fas fa-link mr-2"></i> 링크 복사
        </button>
      </div>
    </div>

    <!-- 레시피 요약 모달 -->
    <div id="recipeSummaryModal" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] hidden flex items-center justify-center p-4" onclick="closeRecipeSummary()">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-700" onclick="event.stopPropagation()" style="background-color: var(--card-bg); border-color: var(--border-color);">
            <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700" style="border-color: var(--border-color);">
                <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200" id="recipeSummaryTitle" style="color: var(--text-primary);"></h2>
                <button onclick="closeRecipeSummary()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" style="color: var(--text-secondary);">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 bg-white dark:bg-gray-800" id="recipeSummaryContent" style="background-color: var(--card-bg); color: var(--text-primary);">
                <!-- 내용이 동적으로 채워집니다 -->
            </div>
        </div>
    </div>

    <!-- 공유하기 모달 열기/닫기 함수 및 각 플랫폼별 공유 함수 -->
    <script>
    window.closeShareModal = function() {
        document.getElementById('shareModal').style.display = 'none';
        document.body.style.overflow = '';
    }
    window.copyShareLink = function() {
        if (!window._shareUrl) return;
        navigator.clipboard.writeText(window._shareUrl)
            .then(() => alert('링크가 복사되었습니다.'))
            .catch(err => alert('링크 복사 실패: ' + err));
    }
    window.shareEmail = function() {
        if (!window._shareUrl) return;
        const subject = encodeURIComponent('AI 도구 추천');
        const body = encodeURIComponent(`${window._shareName}\n${window._shareUrl}`);
        window.open(`mailto:?subject=${subject}&body=${body}`);
    }
    window.shareSms = function() {
        if (!window._shareUrl) return;
        const body = encodeURIComponent(`${window._shareName}\n${window._shareUrl}`);
        window.open(`sms:?body=${body}`);
    }
    window.shareX = function() {
        if (!window._shareUrl) return;
        const text = encodeURIComponent(`${window._shareName} - ${window._shareUrl}`);
        window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
    }
    window.shareFacebook = function() {
        if (!window._shareUrl) return;
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window._shareUrl)}`, '_blank');
    }
    window.shareLine = function() {
        if (!window._shareUrl) return;
        window.open(`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window._shareUrl)}`, '_blank');
    }
    window.shareReddit = function() {
        if (!window._shareUrl) return;
        const title = encodeURIComponent(window._shareName);
        window.open(`https://www.reddit.com/submit?url=${encodeURIComponent(window._shareUrl)}&title=${title}`, '_blank');
    }
    window.shareWhatsApp = function() {
        if (!window._shareUrl) return;
        const text = encodeURIComponent(`${window._shareName} ${window._shareUrl}`);
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }
    window.shareKakao = function() {
        if (!window._shareUrl) return;
        // 카카오톡 공유는 공식 JS SDK가 필요하지만, 간단히 링크 공유로 대체
        const text = encodeURIComponent(`${window._shareName} ${window._shareUrl}`);
        window.open(`https://sharer.kakao.com/talk/friends/picker/link?url=${encodeURIComponent(window._shareUrl)}&text=${text}`, '_blank');
    }
    </script>

    <script>
        // 테마1 전환 관련 코드
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle.querySelector('i');
            
            // 저장된 테마 불러오기
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // 테마 토글 이벤트
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });
            
            // 테마 아이콘 업데이트
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-sun';
                } else {
                    themeIcon.className = 'fas fa-moon';
                }
            }
        });
    </script>

  


    <!-- profile.html에서만 header 우측 메뉴 커스텀 -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function customizeProfileHeader() {
            const profileMenu = document.getElementById('profileMenu');
            if (!profileMenu) {
                setTimeout(customizeProfileHeader, 100);
                return;
            }
            // "로그아웃" 버튼만 노출
            profileMenu.innerHTML = `
                <span id="profileHeaderLogout" class="text-indigo-400 cursor-pointer hover:underline">로그아웃</span>
            `;
            // 로그아웃 이벤트 연결
            document.getElementById('profileHeaderLogout').onclick = async function() {
                try {
                    // Firebase auth 인스턴스 가져오기
                    const { getAuth, signOut } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js');
                    import('../config.js').then(({ firebaseConfig }) => {
                        const app = initializeApp(firebaseConfig);
                        const auth = getAuth(app);
                        signOut(auth).then(() => {
                            alert('로그아웃되었습니다.');
                            window.location.href = 'index.html';
                        }).catch((error) => {
                            alert('로그아웃 중 오류가 발생했습니다.');
                        });
                    });
                } catch (error) {
                    alert('로그아웃 중 오류가 발생했습니다.');
                }
            };
        }
        customizeProfileHeader();
    });
    </script>
</body>
</html> 